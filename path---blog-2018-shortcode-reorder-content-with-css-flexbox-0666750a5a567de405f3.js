webpackJsonp([0xb8f010c0a083],{532:function(n,s){n.exports={data:{blog:{html:'<p>Ever had a situation where you have elements side by side on desktop, but they stack in the wrong order on mobile? Maybe the image should be above the title, or vice versa. Move the image (or any element) under content if it\'s hardcoded above it in HTML using this bit of CSS Flexbox magic:</p>\n<div class="gatsby-highlight">\n      <pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">\n<span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n    <span class="token selector">.container</span> <span class="token punctuation">{</span>\n    <span class="token property">display</span><span class="token punctuation">:</span> -webkit-box<span class="token punctuation">;</span>\n    <span class="token property">display</span><span class="token punctuation">:</span> -moz-box<span class="token punctuation">;</span>\n    <span class="token property">display</span><span class="token punctuation">:</span> -ms-flexbox<span class="token punctuation">;</span>\n    <span class="token property">display</span><span class="token punctuation">:</span> -webkit-flex<span class="token punctuation">;</span>\n    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>\n    <span class="token property">-webkit-box-orient</span><span class="token punctuation">:</span> vertical<span class="token punctuation">;</span>\n    <span class="token property">-moz-box-orient</span><span class="token punctuation">:</span> vertical<span class="token punctuation">;</span>\n    <span class="token property">-webkit-flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>\n    <span class="token property">-ms-flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>\n    <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token selector">.content</span> <span class="token punctuation">{</span>\n    <span class="token property">-webkit-box-ordinal-group</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n    <span class="token property">-moz-box-ordinal-group</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n    <span class="token property">-ms-flex-order</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n    <span class="token property">-webkit-order</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n    <span class="token property">order</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token selector">.sidebar</span> <span class="token punctuation">{</span>\n    <span class="token property">-webkit-box-ordinal-group</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>\n    <span class="token property">-moz-box-ordinal-group</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>\n    <span class="token property">-ms-flex-order</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>\n    <span class="token property">-webkit-order</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>\n    <span class="token property">order</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sidebar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n</code></pre>\n      </div>\n<p>The code works by hard-coding the "order" property, which flexbox uses to determine the order the elements should be displayed. We only hard-code it on mobile, using CSS Media Queries.</p>\n<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">ðŸ“² Need to put your sidebar under your content on mobile? Use <a href="https://twitter.com/hashtag/CSS?src=hash&amp;ref_src=twsrc%5Etfw">#CSS</a> <a href="https://twitter.com/hashtag/Flexbox?src=hash&amp;ref_src=twsrc%5Etfw">#Flexbox</a> and <a href="https://twitter.com/hashtag/MediaQueries?src=hash&amp;ref_src=twsrc%5Etfw">#MediaQueries</a> to reorder the elements on smaller viewports: <a href="https://t.co/SKdeseL2JB">https://t.co/SKdeseL2JB</a> <a href="https://twitter.com/hashtag/HTML?src=hash&amp;ref_src=twsrc%5Etfw">#HTML</a> <a href="https://twitter.com/hashtag/CodeSnippets?src=hash&amp;ref_src=twsrc%5Etfw">#CodeSnippets</a> <a href="https://t.co/0vXjAfBEyW">pic.twitter.com/0vXjAfBEyW</a></p>&mdash; Ryosuke (@whoisryosuke) <a href="https://twitter.com/whoisryosuke/status/1004117307411427329?ref_src=twsrc%5Etfw">June 5, 2018</a></blockquote>\n<p>Hope that helps,\nRyo</p>\n<hr>\n<p><strong>References</strong></p>\n<ul>\n<li><a href="https://twitter.com/whoisryosuke/status/1004117307411427329">Original tweet</a></li>\n<li><a href="https://gist.github.com/whoisryosuke/b8b67331d115b772c4dae99fea16fe79">See the code gist</a></li>\n</ul>',frontmatter:{title:"shortcode - Reorder content with CSS Flexbox",cover_image:{publicURL:"/static/shortcode-code-snippets-88148405a821950263064ed5b62734ac.jpg",childImageSharp:{sizes:{tracedSVG:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='267' viewBox='0 0 400 267' version='1'%3E%3Cpath d='M0 134v133h10c11 0 14-1 14-6l1-1c1 0 3-5 3-9 0-2 0-3 2-3s2-1 2-4v-4h4l4-1h8l5-3 6-4c2 0 2-1 2-4v-4h6c4 0 5 0 5-2s1-2 4-2c4 0 7 2 7 3 0 3 4 5 8 5h5v-12h8v-8h16v-8h4c4 0 4 0 4-2 0-3 0-3 4-3l4-1c0-2 1-2 4-2l4-1c0-2 2-2 8-2 8 0 8 0 8-2 0-3 0-3 4-3 3 0 4 0 4 2l1 2 3-2 3-2 1-3c0-3 2-4 4-2l2 1c2 0 4-3 3-4l3-6 2 3 2 4v-9h8v4l1 4 1-4c0-3 0-4 2-4l1-4c0-3 0-4 2-4l1-1 4-1 8-2c3-2 4-2 4-1 0 2 1 2 4 2l4-1c0-2 1-2 4-2l4-1h2c2 2 2 2 3 0 2-1 2-2-1-3l-8-2-4-1h4l9-1 7-2c4 0 4 0 4-3s0-3 4-3 4 0 4-2c0-3 0-3 4-3l4-1 4-1h4v-4c0-5 0-5 3-4l4-1c2-2 3-4 1-3s-7-1-5-2c1-1 1-1-1-1-2 1-5-4-4-9l1-5c1-3 12-1 12 3h2l1-2 4-4-1 2v1l2-2h4c2-3 1-3-3-3l-4 1-1 1-1-1c0-3 10-3 12 0 1 1 1 1 2-1 1-1 1-1 1 1-1 2 0 3 2 3l2 3 2-1 4-3 4-2v3l2 4c0 2 0 2-1 1l-1-1 1 3v3l1 3 1-5c0-8 1-9 5-9h1c-3 0-2-3 1-2 2 0 2 0 1-1s-1-1 2-1 3 0 2 1l-2 1-1 1 2 1v1l1 2 1 1c0-3 2-2 2 1s0 3 1 1l1-4c1 0 1-1-1-1-1-1-1-1 1-1 3 0 3-2 0-3h-2l2-1 3 1h1l3 2h2l-1-2 3-3c1 1 2 2 2 5v5l1-4c0-4 0-4 1-2v4l1 1 1-2 2-3c1-1 1-1-1-1-2 1-2 0-2-1 0-2 0-2 1-1l4 1 4 1h-2l-1 1 3 1h1c0 2 4 1 5-1l1-2 1-1c0-2 1-2 4-2 4 0 4 0 4-2l1-3 1-4-1-4-1-1c0-2 1-2 4-2s4 0 4 2l4 1h4v93c0 81 1 75 1-40V0H0v134m263-36l-1 3v10c-1 1-1 1-2-2l-2-2h-3c-3-2-3-4-1-4v1l1 1h1v1l1-2v-1c3 1 3-1 1-2-3-1-10 2-10 5 0 2 0 2 1 1l1-1c1 1 2 3 4 3l3 3c-1 3-3 4-6 1l-3-2 1 2v3a1139 1139 0 0 1 9 0c2-1 2-1 2 1s2 0 2-3c1-2 1-2 1 0 0 5 2 3 3-3 0-6 1-8 4-8 2 1 2 1 2 5v8c2 5 4 5 3-1 0-3 0-3 1 0l1 1v-3l-1-5c1-5-2-7-7-7-3 1-4 1-3-1v-5c-1-1-2 0-3 3' fill='lightgray' fill-rule='evenodd'/%3E%3C/svg%3E",src:"/static/shortcode-code-snippets-88148405a821950263064ed5b62734ac-4e8db.jpg",srcSet:"/static/shortcode-code-snippets-88148405a821950263064ed5b62734ac-7cc04.jpg 310w,\n/static/shortcode-code-snippets-88148405a821950263064ed5b62734ac-69042.jpg 620w,\n/static/shortcode-code-snippets-88148405a821950263064ed5b62734ac-4e8db.jpg 1240w,\n/static/shortcode-code-snippets-88148405a821950263064ed5b62734ac-50ab1.jpg 1860w,\n/static/shortcode-code-snippets-88148405a821950263064ed5b62734ac-e738f.jpg 1920w"}}},date:"05 June, 2018",tags:["laravel","php","api","shortcode","code snippet","tips"],section:"blog"},fields:{slug:"/blog/2018/shortcode-reorder-content-with-css-flexbox/"}},relatedPosts:{edges:[{node:{html:'<p>Lately I\'ve been trying my best to get into TDD, test-driven development, which is a style of programming where you build tests alongside your code. I picked <a href="http://laravel.com">Laravel</a> a while ago as my primary PHP framework for a lot of projects because of how easy it makes testing. Laravel makes it simple -- from making a test (<code class="language-text">php artisan make:test YourTest</code>), to the easy to use API they provide for interfacing with PHPUnit (<code class="language-text">$this-&gt;assertStatus(404)</code>).</p>\n<p>Laravel does a great job of documenting their framework, and <a href="https://laravel.com/docs/master/testing">the official docs</a> are usually more up to date than most code bases and tutorials I scoured the net to find. However, the testing docs are also incredibly simplified, and missing crucial steps (like how to run a test). It left me wondering if there was something I was missing.</p>\n<p>After a bit of tinkering around, here\'s what I discovered.</p>\n<h2>Testing JSON APIs</h2>\n<p>The most recent version of Laravel has <a href="https://laravel.com/docs/5.6/http-tests#testing-json-apis">special testing methods for JSON APIs.</a> It allows us to query Laravel\'s internal API directly and easily make assertions on the response.</p>\n<h2>Writing your first test</h2>\n<p>Let\'s make the test first. Use the following <code class="language-text">artisan</code> command:</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code class="language-bash">php artisan make: <span class="token function">test</span> ShopTest\n</code></pre>\n      </div>\n<p>Now you can open up your first test file located in <code class="language-text">tests/Feature/ShopTest.php</code> and add a JSON API call:</p>\n<div class="gatsby-highlight">\n      <pre class="language-php"><code class="language-php"><span class="token delimiter important">&lt;?php</span>\n\n<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\\</span>Feature</span><span class="token punctuation">;</span>\n\n<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\\</span>TestCase</span><span class="token punctuation">;</span>\n<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Foundation<span class="token punctuation">\\</span>Testing<span class="token punctuation">\\</span>WithFaker</span><span class="token punctuation">;</span>\n<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Foundation<span class="token punctuation">\\</span>Testing<span class="token punctuation">\\</span>RefreshDatabase</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">ShopTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">/**\n     * Tests shop index without params to see if it works\n     *\n     * @return void\n     */</span>\n    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testShopIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token single-quoted-string string">\'GET\'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">\'/api/v1/shops\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token variable">$response</span>\n            <span class="token operator">-</span><span class="token operator">></span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<h3>How it works</h3>\n<p>We first query the API using the <code class="language-text">json()</code> method which returns a response from the API. Then we check the response and <strong>assert</strong> certain things, like the status code (<code class="language-text">assertStatus()</code>), or data itself (<code class="language-text">assertJson</code>).</p>\n<h3>Debugging tests</h3>\n<p>If at any point the test fails, and you\'re not sure why, just do a <code class="language-text">dd($response)</code> to dump the response into the console. You can also use commands like <code class="language-text">var_dump($variable)</code> to print out text in the console during tests. It helps verify when a method returns a boolean (like deleting a resource) or verifying properties exist on a resource (e.g. <code class="language-text">$post-&gt;id</code>). Be wary of using <code class="language-text">var_dump()</code> for larger variables (like the response object) - it tends to crash and freeze tests.</p>\n<blockquote>\n<p>Be careful when asserting data with duplicate property names, even if they\'re nested (e.g. <code class="language-text">{ id: 1, comment { id: 129 } }</code>). assertJson will collapse the array and assume you mean both IDs. In this case, you have to use assertExactJson to check duplicate property names.</p>\n</blockquote>\n<h2>Running the tests</h2>\n<p>Laravel doesn\'t actually write this anywhere in their docs, and you\'d assume that you can run a test with something like <code class="language-text">php artisan test</code> -- but you actually have to use the PHPUnit library in your composer dependencies:</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code class="language-bash">./vendor/bin/phpunit\n</code></pre>\n      </div>\n<p>Run that command from the project root and PHPUnit will run all tests located in your <code class="language-text">/tests/</code> folder. </p>\n<blockquote>\n<p>Make sure all composer dependencies are installed or you won\'t be able to run this script. And if you\'re running Laravel inside of Docker, make sure to run PHPUnit inside the container <code class="language-text">docker-compose exec workspace ./vendor/bin/phpunit</code></p>\n</blockquote>\n<h3>Running a single test</h3>\n<p>Sometimes you need to run a single test in isolation. I had to look this one up too:</p>\n<p><code class="language-text">./vendor/bin/phpunit --filter TestControllerName</code></p>\n<p>This also works as well, albeit more verbose:</p>\n<p><code class="language-text">./vendor/bin/phpunit  tests/Feature/TestControllerName.php</code></p>\n<h2>Keep it simple silly</h2>\n<p>I found that with basic Laravel APIs, you tend to repeat the same tests over and over again. Wouldn\'t it be nice if an API test looked like one of our Models, and was as simple as writing an extended class with protected variables?:</p>\n<div class="gatsby-highlight">\n      <pre class="language-php"><code class="language-php"><span class="token delimiter important">&lt;?php</span>\n<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\\</span>Feature<span class="token punctuation">\\</span>Controllers</span><span class="token punctuation">;</span>\n<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\\</span>CrudTest</span><span class="token punctuation">;</span>\n<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Foundation<span class="token punctuation">\\</span>Testing<span class="token punctuation">\\</span>WithFaker</span><span class="token punctuation">;</span>\n<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Foundation<span class="token punctuation">\\</span>Testing<span class="token punctuation">\\</span>RefreshDatabase</span><span class="token punctuation">;</span>\n<span class="token keyword">class</span> <span class="token class-name">StrainsControllerTest</span> <span class="token keyword">extends</span> <span class="token class-name">CrudTest</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">/**\n     * The model to use when creating dummy data\n     *\n     * @var class\n     */</span>\n    <span class="token keyword">protected</span> <span class="token variable">$model</span> <span class="token operator">=</span> \\<span class="token package">KushyApi<span class="token punctuation">\\</span>Posts</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">;</span>\n    <span class="token comment">/**\n     * The endpoint to query in the API\n     * e.g = /api/v1/&lt;endpoint>\n     *\n     * @var string\n     */</span>\n    <span class="token keyword">protected</span> <span class="token variable">$endpoint</span> <span class="token operator">=</span> <span class="token single-quoted-string string">\'strains\'</span><span class="token punctuation">;</span>\n    <span class="token comment">/**\n     * Any additional "states" to add to factory\n     *\n     * @var string\n     */</span>\n    <span class="token keyword">protected</span> <span class="token variable">$states</span> <span class="token operator">=</span> <span class="token single-quoted-string string">\'strains\'</span><span class="token punctuation">;</span>\n    <span class="token comment">/**\n     * Extra data to pass to POST endpoint \n     * aka the (store() method)\n     * \n     * Must be array (ends up merged with another)\n     *\n     * @var array\n     */</span>\n    <span class="token keyword">protected</span> <span class="token variable">$store</span> <span class="token operator">=</span> <span class="token punctuation">[</span>\n        <span class="token single-quoted-string string">\'category\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">\'1\'</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>With the power of abstract classes in OOP, we can create a kind of <em>base</em> class to <em>extend</em> the functionality of our specific endpoint\'s test class. Let\'s create a new test called <code class="language-text">tests/CrudTest.php</code>:</p>\n<div class="gatsby-highlight">\n      <pre class="language-php"><code class="language-php"><span class="token delimiter important">&lt;?php</span>\n<span class="token keyword">namespace</span> <span class="token package">Tests</span><span class="token punctuation">;</span>\n\n<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\\</span>TestCase</span><span class="token punctuation">;</span>\n<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\\</span>Traits<span class="token punctuation">\\</span>AttachJwtToken</span><span class="token punctuation">;</span>\n<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Foundation<span class="token punctuation">\\</span>Testing<span class="token punctuation">\\</span>WithFaker</span><span class="token punctuation">;</span>\n<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\\</span>Foundation<span class="token punctuation">\\</span>Testing<span class="token punctuation">\\</span>RefreshDatabase</span><span class="token punctuation">;</span>\n\n<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">CrudTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">use</span> <span class="token package">AttachJwtToken</span><span class="token punctuation">;</span>\n\n    <span class="token comment">/**\n     * Uses the model factory to generate a fake entry\n     *\n     * @return class\n     */</span>\n    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">createPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">states</span><span class="token punctuation">)</span>\n        <span class="token punctuation">{</span>\n            <span class="token keyword">return</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">model</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">states</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">states</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        \n        <span class="token keyword">return</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">model</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">/**\n     * GET /endpoint/\n     * Should return 201 with data array\n     *\n     * @return void\n     */</span>\n    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token single-quoted-string string">\'GET\'</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"api/v1/<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endpoint</span><span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token variable">$response</span>\n            <span class="token operator">-</span><span class="token operator">></span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span>\n            <span class="token operator">-</span><span class="token operator">></span><span class="token function">assertJson</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n                <span class="token single-quoted-string string">\'data\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">true</span>\n            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">/**\n     * GET /endpoint/&lt;id>\n     * Should return 201 with data array\n     *\n     * @return void\n     */</span>\n    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token comment">// Create a test shop with filled out fields</span>\n        <span class="token variable">$activity</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">createPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">// Check the API for the new entry</span>\n        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token single-quoted-string string">\'GET\'</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"api/v1/<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endpoint</span><span class="token punctuation">}</span></span>/<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$activity</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span><span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">// Delete the test shop</span>\n        <span class="token variable">$activity</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token variable">$response</span>\n            <span class="token operator">-</span><span class="token operator">></span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span>\n            <span class="token operator">-</span><span class="token operator">></span><span class="token function">assertJson</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n                <span class="token single-quoted-string string">\'data\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">true</span>\n            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">/**\n     * POST /endpoint/\n     *\n     * @return void\n     */</span>\n    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token variable">$activity</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">createPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token variable">$activity</span> <span class="token operator">=</span> <span class="token variable">$activity</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">/**\n         * Pass in any extra data\n         */</span>\n        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">store</span><span class="token punctuation">)</span>\n        <span class="token punctuation">{</span>\n            <span class="token variable">$activity</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$activity</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">store</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token single-quoted-string string">\'POST\'</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"api/v1/<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endpoint</span><span class="token punctuation">}</span></span>/"</span><span class="token punctuation">,</span> <span class="token variable">$activity</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">model</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token variable">$activity</span><span class="token punctuation">[</span><span class="token single-quoted-string string">\'id\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token variable">$response</span>\n            <span class="token operator">-</span><span class="token operator">></span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span>\n            <span class="token operator">-</span><span class="token operator">></span><span class="token function">assertJson</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n                <span class="token single-quoted-string string">\'data\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">true</span>\n            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    \n    <span class="token comment">/**\n     * DELETE /endpoint/&lt;id>\n     * Tests the destroy() method that deletes the shop\n     *\n     * @return void\n     */</span>\n    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token variable">$activity</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">createPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token single-quoted-string string">\'DELETE\'</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"api/v1/<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">endpoint</span><span class="token punctuation">}</span></span>/<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$activity</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span><span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token variable">$response</span>\n            <span class="token operator">-</span><span class="token operator">></span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>This class tests the index, show, store, and destroy methods that come in the basic API controllers that artisan generates for you. And it does it dynamically, using the variables you define in your endpoint\'s test class.</p>\n<h3>Testing with Factories</h3>\n<p>This requires that you have a <strong>Factory</strong> for your class, so the <code class="language-text">createPost()</code> method can generate fake data to test. Factories use the <a href="https://github.com/fzaninotto/Faker">Faker library</a> to generate fake data for a specific model, whether you need it for tasks seeding or testing. Say you need to create 50 users - a factory will generate random (and even unique) names, passwords, and emails for all 50.</p>\n<p>Creating factories are very simple, <a href="https://laravel.com/docs/5.6/database-testing#generating-factories">check out the Laravel docs.</a> Here\'s an example of one with a few different types of fields (images, location data, etc):</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code class="language-bash">php artisan make:factory YourModelNameFactory\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-php"><code class="language-php"><span class="token delimiter important">&lt;?php</span>\n\n<span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\\</span>Generator</span> <span class="token keyword">as</span> Faker<span class="token punctuation">;</span>\n\n<span class="token variable">$factory</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">define</span><span class="token punctuation">(</span>YourAppName\\<span class="token package">YourModelName</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Faker <span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>\n        <span class="token single-quoted-string string">\'id\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">uuid</span><span class="token punctuation">,</span>\n        <span class="token single-quoted-string string">\'name\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">,</span>\n        <span class="token single-quoted-string string">\'slug\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">slug</span><span class="token punctuation">,</span>\n        <span class="token single-quoted-string string">\'featured_img\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">imageUrl</span><span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token single-quoted-string string">\'avatar\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">imageUrl</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token single-quoted-string string">\'description\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">paragraph</span><span class="token punctuation">,</span>\n        <span class="token single-quoted-string string">\'latitude\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">latitude</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token single-quoted-string string">\'longitude\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">longitude</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token single-quoted-string string">\'address\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">streetAddress</span><span class="token punctuation">,</span>\n        <span class="token single-quoted-string string">\'city\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">city</span><span class="token punctuation">,</span>\n        <span class="token single-quoted-string string">\'state\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">state</span><span class="token punctuation">,</span>\n        <span class="token single-quoted-string string">\'postal_code\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">postcode</span><span class="token punctuation">,</span>\n        <span class="token single-quoted-string string">\'country\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">country</span><span class="token punctuation">,</span>\n        <span class="token single-quoted-string string">\'rating\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">numberBetween</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token single-quoted-string string">\'featured\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">numberBetween</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token single-quoted-string string">\'verified\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">numberBetween</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token variable">$factory</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">state</span><span class="token punctuation">(</span>YourAppName\\<span class="token package">YourModelName</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">\'product\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>\n    <span class="token single-quoted-string string">\'category\'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">\'Product\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<blockquote>\n<p>Use <em>states</em> to add extra data or modify existing params in your fake Model entry. <code class="language-text">factory(YourModelName::class)-&gt;state(&#39;product&#39;);</code>Works great if you need to have control over a model\'s specific parameter(s), like setting a user as an admin or customer. In this case, we set the post\'s category.</p>\n</blockquote>\n<h2>Handling JWT</h2>\n<p>If you noticed, I have a trait on the abstract class called <code class="language-text">AttachJwtToken</code>. I use Laravel\'s Passport package and connect to the API using OAuth2 authentication. Because of this, all JSON requests in tests require the proper authorization headers (with a JWT for the user).</p>\n<p>The <code class="language-text">AttachJwtToken</code> trait handles this process for us. I found this originally <a href="https://gist.github.com/jgrossi/4b1364e20418eca3ca937e70550c1823">on Github by @jgrossi</a> and based my code off it. It checks for an existing user (which you can pass in using the <code class="language-text">loginAs</code> method), and if no user is found, creates one, and returns a JWT for the user (using Laravel Passport\'s built in <code class="language-text">createToken()</code> function)</p>\n<p><a href="https://gist.github.com/whoisryosuke/2ee866ba6c32af5b4614ac6136a0012a">Check out my full source code on Gist</a></p>\n<h2>It\'s that simple!</h2>\n<p>It really is this <strong>simple</strong> to test your API <em>(if it\'s a simple CRUD API).</em> </p>\n<p>The hardest part of researching testing was feeling secure in the amount of information I\'d accrued. At the end of the day, when you look at the source code, there are only so many testing methods Laravel/PHPUnit provides. You assert one thing or another, whether it\'s the status code or JSON itself, or mock users using the <code class="language-text">actingAs($user)</code>.</p>\n<p>What becomes <strong>more complex</strong> are tasks like replicating features that span across multiple controllers, jobs, services, etc -- or mocking functionality like image storage. Or just creating factories for all your models. </p>\n<p>Testing is easy, setting up the proper conditions becomes the true <em>test</em>.</p>\n<p>Hope this helps your API TDD ðŸ¤˜\nRyo</p>\n<hr>\n<p><strong>References</strong>:</p>\n<ul>\n<li><a href="https://gist.github.com/whoisryosuke/2ee866ba6c32af5b4614ac6136a0012a">Attach JWT Token to Test snippet</a></li>\n<li><a href="https://laravel.com/docs/5.6/http-tests#testing-json-apis">Laravel Docs - Testing JSON APIs</a></li>\n<li><a href="https://github.com/fzaninotto/Faker#fakerprovideruuid">Faker docs</a></li>\n<li><a href="https://course.testdrivenlaravel.com/">Test Driven Laravel course (paid with free samples via email)</a></li>\n<li><a href="https://dev.to/lechatthecat/how-to-use-phpunit-for-laravel-3d3c">Using PHPUnit for Laravel Testing</a></li>\n<li><a href="https://dev.to/fatboyxpc/laravel-testing-woes-token-mismatch-28pd">Laravel Testing Woes: Token Mismatch</a></li>\n</ul>',
frontmatter:{title:"Adding testing to a Laravel API ðŸ“",cover_image:{publicURL:"/static/Adding-testing-to-a-Laravel-API-1920px-1e020cc22000c4bc9fc2a2eded8878f5.jpg",childImageSharp:{sizes:{src:"/static/Adding-testing-to-a-Laravel-API-1920px-1e020cc22000c4bc9fc2a2eded8878f5-4e8db.jpg",srcSet:"/static/Adding-testing-to-a-Laravel-API-1920px-1e020cc22000c4bc9fc2a2eded8878f5-7cc04.jpg 310w,\n/static/Adding-testing-to-a-Laravel-API-1920px-1e020cc22000c4bc9fc2a2eded8878f5-69042.jpg 620w,\n/static/Adding-testing-to-a-Laravel-API-1920px-1e020cc22000c4bc9fc2a2eded8878f5-4e8db.jpg 1240w,\n/static/Adding-testing-to-a-Laravel-API-1920px-1e020cc22000c4bc9fc2a2eded8878f5-50ab1.jpg 1860w,\n/static/Adding-testing-to-a-Laravel-API-1920px-1e020cc22000c4bc9fc2a2eded8878f5-e738f.jpg 1920w"}}},date:"03 August, 2018",tags:["laravel","tdd","testing","api","php","phpunit"]},fields:{slug:"/blog/2018/adding-testing-to-laravel-api/"}}},{node:{html:'<p>Recently I needed to create a NextJS app that made authenticated API calls, and couldn\'t reveal it\'s credentials to the client. The solution was simple, I had to integrate Express into the app. But how do you fetch data from the API and pass it down to a page?</p>\n<blockquote>\n<p>This process assumes you have an environment setup with NextJS, Express, an isomorphic fetch solution, and dotenv (for ENV variables). If you follow the NextJS guide for dynamic routing you be mostly there. But it should be pretty easy to adapt to other server frameworks.</p>\n</blockquote>\n<h2>Async or bust</h2>\n<p>I tried to first fetch the data in a separate function and call it before the page was rendered in the route:</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> credentials <span class="token operator">=</span> <span class="token punctuation">{</span>\n  method<span class="token punctuation">:</span> <span class="token string">\'get\'</span><span class="token punctuation">,</span>\n  headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token string">\'Content-Type\'</span><span class="token punctuation">:</span> <span class="token string">\'application/json\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'Authorization\'</span><span class="token punctuation">:</span> <span class="token string">\'Basic \'</span> <span class="token operator">+</span> <span class="token function">btoa</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>API_USER <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>API_VENDOR<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">fetchApi</span> <span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>API_URL <span class="token operator">+</span> endpoint<span class="token punctuation">,</span> credentials<span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>r <span class="token operator">=></span> r<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n    server<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'/facilities\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">fetchApi</span><span class="token punctuation">(</span><span class="token string">\'/facilities/v1/\'</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=></span> <span class="token keyword">return</span> data<span class="token punctuation">)</span>\n\n      <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token string">\'/facilities\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre>\n      </div>\n<p>This resulted in the page rendering and loading, and the data loading afterwards. Simple mistake, especially if you come from a background that isn\'t asynchronous. </p>\n<p>But how do you create an async Express route? Shockingly easily apparently:</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js">    server<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'/facilities\'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchApi</span><span class="token punctuation">(</span><span class="token string">\'/facilities/v1/\'</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=></span> <span class="token keyword">return</span> data<span class="token punctuation">)</span>\n\n      <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token string">\'/facilities\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre>\n      </div>\n<p>Add an async before the function that renders your route -- *because don\'t stress it, it\'s easy to forget that you\'re working <strong>inside</strong> a function*. Now you just slap an await on Promise you want to fetch before page load.</p>\n<h2>But can we make it reusable?</h2>\n<p>I needed to fetch data across many routes, with many different requests to different endpoints. Rather than repeating code in every route to make the API request, we make a <strong>middleware</strong> that does it and dumps the data in the <code class="language-text">res.locals</code> (which is accessible in our route).</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token comment">// Credentials for authenticated fetch calls to API</span>\n<span class="token keyword">const</span> credentials <span class="token operator">=</span> <span class="token punctuation">{</span>\n  method<span class="token punctuation">:</span> <span class="token string">\'get\'</span><span class="token punctuation">,</span>\n  headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token string">\'Content-Type\'</span><span class="token punctuation">:</span> <span class="token string">\'application/json\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'Authorization\'</span><span class="token punctuation">:</span> <span class="token string">\'Basic \'</span> <span class="token operator">+</span> <span class="token function">btoa</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>API_USER <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>API_VENDOR<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/**\n * Facade for fetch preloaded with authentication credentials\n * to easily use in any other function\n */</span>\n<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchApi</span> <span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>API_URL <span class="token operator">+</span> endpoint<span class="token punctuation">,</span> credentials<span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>r <span class="token operator">=></span> r<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/**\n * A function that returns the middleware function\n * We nest the middleware in a function so we can \n * pass an endpoint, making the middleware more reusable\n */</span>\n<span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    \n    <span class="token comment">/**\n     * Here we create an async function so\n     * we can load the data before the page renders\n     */</span>\n    <span class="token keyword">const</span> fetchData <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">await</span> <span class="token function">fetchApi</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token comment">// We place the data in res.locals to access in the route later</span>\n          res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>data <span class="token operator">=</span> data\n          <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        \n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\napp<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    server<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'/facilities\'</span><span class="token punctuation">,</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">\'/facilities/v1/\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token string">\'/facilities\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>data <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre>\n      </div>\n<p>The code explains it a bit, but I had to nest the middleware function inside another function in order to pass the endpoint parameter. It\'s the way that JS works, similar to when you use <code class="language-text">.map()</code> or <code class="language-text">.filter()</code> on an array and you want to pass a parameter but can\'t. It\'s an encapsulation issue caused by the way Express interprets it\'s middleware, forcing you to wrap it what the React community calls a "HOC", or a function that returns another function (so you can pass additional "props" to the child function - or component in React\'s case).</p>\n<p>Now in any route we simply add the middleware <code class="language-text">getData(endpoint)</code>.</p>\n<blockquote>\n<p>You could also just do a fetch in the middleware <strong>without the async</strong> and rely on <code class="language-text">next()</code> function in the promise chain. It\'ll hold the progress until the loading is complete and then provide the "next" function (usually the render function). I just left everything async just in case I refactor it out of the middleware.</p>\n</blockquote>\n<h3>Super middleware</h3>\n<p>You could take this middleware and apply it to the entire application (rather than a single route), and use the <code class="language-text">req.params</code> object to grab dynamic route variables (like a blog post ID, or in this case, a string that describes an endpoint). </p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> endpoint <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>endpoint\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    \n    <span class="token comment">/**\n     * Here we create an async function so\n     * we can load the data before the page renders\n     */</span>\n    <span class="token keyword">const</span> fetchData <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">await</span> <span class="token function">fetchApi</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token comment">// We place the data in res.locals to access in the route later</span>\n          res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>data <span class="token operator">=</span> data\n          <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        \n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n   <span class="token comment">// later in the app...</span>\n    server<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">\'/:endpoint\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>endpoint<span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>data <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre>\n      </div>\n<p>This allows for a completely dynamic connection to whichever API you\'re using, so depending on how large (and preferably simple) it is to access, you can use <strong>one middleware to rule them all.</strong></p>\n<h2>I â¤ï¸ middleware</h2>\n<p>Middleware makes life so much easier, and makes application code so much slimmer. If you can find a way to simplify this code (without getting too deep into ES6 land), I challenge you to post it up in the comments! I\'m always interested in discovering and sharing the most efficient solutions to common problems.</p>\n<p>Hope that helps! âœŒï¸\nRyo </p>\n<hr>\n<p><strong>References</strong>:</p>\n<ul>\n<li><a href="https://expressjs.com/en/guide/using-middleware.html">ExpressJS Middleware</a></li>\n<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function">MDN: async function</a></li>\n<li><a href="https://hackernoon.com/middleware-the-core-of-node-js-apps-ab01fee39200">Middleware: THE core of node.js backend apps</a></li>\n<li><a href="https://medium.com/@Abazhenov/using-async-await-in-express-with-node-8-b8af872c0016">Async Express routes</a></li>\n</ul>',frontmatter:{title:"Express Middleware for API Requests",cover_image:{publicURL:"/static/Express-Middleware-for-API-Requests-1920px-52330e681ae16f3c2210acb276021f1b.jpg",childImageSharp:{sizes:{src:"/static/Express-Middleware-for-API-Requests-1920px-52330e681ae16f3c2210acb276021f1b-4e8db.jpg",srcSet:"/static/Express-Middleware-for-API-Requests-1920px-52330e681ae16f3c2210acb276021f1b-7cc04.jpg 310w,\n/static/Express-Middleware-for-API-Requests-1920px-52330e681ae16f3c2210acb276021f1b-69042.jpg 620w,\n/static/Express-Middleware-for-API-Requests-1920px-52330e681ae16f3c2210acb276021f1b-4e8db.jpg 1240w,\n/static/Express-Middleware-for-API-Requests-1920px-52330e681ae16f3c2210acb276021f1b-50ab1.jpg 1860w,\n/static/Express-Middleware-for-API-Requests-1920px-52330e681ae16f3c2210acb276021f1b-e738f.jpg 1920w"}}},date:"23 July, 2018",tags:["nextjs","express","js","api","es6","tips"]},fields:{slug:"/blog/2018/express-middleware-for-api-requests/"}}}]}},pathContext:{tag:"api",slug:"/blog/2018/shortcode-reorder-content-with-css-flexbox/"}}}});
//# sourceMappingURL=path---blog-2018-shortcode-reorder-content-with-css-flexbox-0666750a5a567de405f3.js.map